# CYBR473 Assignment 2: Advanced Static and Dynamic Analysis
***

## Abstract
Assessment 2 is worth 30% of the overall grade for the course and will involve showing your ability to apply the tools introduced in the course and your ability to carry out advanced static and dynamic analysis of malware. However, you also need to utilise basic static and dynamic techniques/tools for malware analysis. You have four weeks to complete this assignment.
It is your job to use malware analysis methods learnt from the lectures to document specific characteristics and behaviours of malware.
We recommend storing your virtual machine on the scratch drive when using the lab machines. You will want to create a subdirectory to make it easier to distinguish your VM from any other users, e.g. Harith would create one called /local/scratch/harith. Do not save to your own ECS filesystem because you will quickly run out of space.
The assignment web page provides a link to download the Windows 7 OVA file required for the assignment and REMnux (a Linux to a distribution with pre-installed malware analysis tools) required for the analysis of network-related activities (this VM will also be used in Assignment 2). 

## Assignment Goals
You are expected to use malware analysis methods learnt from the lectures to document specific characteristics and behaviours of malware. Specifically, this assignment's core focus is on disassemblers and debuggers for dissecting malware.
You will work with the Windows 7 image provided via the course website with various malware tools installed. We have also provided a Linux distribution called REMnux with forensic tools installed. The website also explains how to set up a local network with both hosts. 

## Assignment Components
This assignment is worth 30% of the overall grade for the course and has four components: 
* Demonstrating mastery of the tools: You will practice using the tools that you will use to complete the three other tasks and submit a video demonstrating what you have learnt by completing labs from practical malware analysis. This component is worth 10% of the grade. 
* Software cracking task: You submit a video that requires you to apply reverse engineering skills to manipulate a software look-and-feel and functionality. This component is worth 30% of the grade. 
* Malware analysis task: You will write an individual report on an unknown piece of malware. This component is worth 40% of the grade. 
* Malware behavior from source code: You should write short answers to some questions by analysing source code (in C/C++) of some malware. This component is worth 20% of the grade. 

## Demo Video
These labs use the samples from the book. You are allowed and highly encouraged to look at the answers because we want you to gain experience with working with the Virtual Machine environment, demonstrate that you can use the tools and show that you can record a screencast showing your lab work.
To complete this part of the assignment, ONLY advanced static and dynamic analysis tools are required. Although you are encouraged to perform basic static and dynamic analysis, you won't be penalised for not doing so.
The labs are designed to run on a Windows XP machine with administrative privileges. Many labs will work on Windows Vista or Windows 7, but some will not. Also, when demonstrating, explain why you are doing things as much as what you are doing.
The lab executables are found under the Downloads directory under Practical Malware Analysis Labs.

### Analyzing Code Constructs
Review Labs 6-1 and 6-2. The binaries are found under BinaryCollection/Chapter_6L.
Create a demonstration video that shows the following with a voice-over describing any choices you have made when doing the analysis:
* Use of Ghdira or IDA disassemblers to discover the purpose of the malware in Lab06-01.exe, and identify its major code construct.
* Use of Ghdira or IDA disassemblers to discover the purpose of the malware in Lab06-02.exe, and explain the subroutine located at 0x40117F. 

### Malware Debugging
Review Labs 9-1, and 9-2. The binaries are found under BinaryCollection/Chapter_9L.
Create a demonstration video that shows the use of the OllyDbg debugger to achieve the following: 
* Permanently patch the malware in Lab09-01.exe so no special command-line password is needed.  
* Analyse how the malware in Lab09-02.exe delivers its payload, and how the program obfuscates the domain name (explain the corresponding routine). 

### Cracking PuTTY
In this part, your task is to change several aspects of existing open-source software. However, you should not rely on or use the source code and only manipulate the binary provided on the following link: https://samsclass.info/127/proj/putty.exe.
Besides other tools, the use of disassemblers, e.g., Ghdira and IDA, and debuggers, e.g., OllyDbg, is essential to complete the tasks of this part.
You may find the following tutorial very helpful: https://samsclass.info/127/proj/pDC12olly.htm.
Complete these four tasks: 
* Defacing 1: Change the text on the title bar only from PuTTY Configuration to CYBR473T1 your student id (e.g. CYBR473T1 300123456).   
* Defacing 2: Change the orientation of the options under Connection type: from horizontal to vertical, i.e., one option per line.
* Functionality 1: Make Telnet to be the selected connection type by default instead of SSH.
* Functionality 2: Switch the functionality of the two buttons, ‘Open’ and ‘Cancel’. 
Please notice that, apart from the first task, i.e., Defacing 1, the second, third and fourth tasks can be accomplished in various ways, and more marks will be given for providing multiple ways to implement them.
Create a demonstration video that shows the following with a voice-over describing what you have done and any choices you have made when doing the work:
* Demonstrate the defacing and modified functionality.
* Show how you implemented these by showing and highlighting changes to the assembly code. 

## Written Report - Myserious Malware
For this part, you will need to set up a proper network for the malware being analysed to perform communication with a command-and-control centre if required. In your report, you do not need to describe the process of how and why you designed your network. However, you will need to demonstrate your observations regarding any network and disk activities.
Most importantly, you need to utilise BOTH basic and advanced static and dynamic malware analysis tools to identify various indicators. Hence, you should perform a complete analysis of the malware in this section.
Analyse the malware found in CYBR473Malware.zip malware (the password is infected) and consider the following points:
* Network design and deployment 
* Malware information, e.g., compilation time, and existing antivirus signatures, including, ClamAV 
* Obfuscation 
* Malware type and purpose 
* System indicators & Network indicators
* Code decompilation possibility 
You should be clear about which tools were used and how they were used. Make sure you reference where you can obtain or read more about these tools/techniques/approaches so that your analysis can be repeated. Furthermore, make sure to provide a coherent document that covers these aforementioned points instead of a Q&A style. Please feel free regarding the organisation of the report, i.e., sectioning. However, you might find it easier to use the points above as the main sections. Alternatively, you can also group various points under different sections.
